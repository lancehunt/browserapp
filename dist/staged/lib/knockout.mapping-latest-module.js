define(["knockout"],function(a){a.exportSymbol=function(a,b){var c=a.split("."),d=window;for(var e=0;e<c.length-1;e++)d=d[c[e]];d[c[c.length-1]]=b},a.exportProperty=function(a,b,c){a[b]=c},function(){function f(a,b){for(var c in b)b.hasOwnProperty(c)&&b[c]&&(!a[c]||a[c]instanceof Array?a[c]=b[c]:f(a[c],b[c]))}function g(a,b){var c={};return f(c,a),f(c,b),c}function h(a){return a&&typeof a=="object"&&a.constructor==(new Date).constructor?"date":typeof a}function i(a,b){a=a||{};if(a.create instanceof Function||a.key instanceof Function||a.arrayChanged instanceof Function)a={"":a};return b&&(a.ignore=j(b.ignore,a.ignore),a.include=j(b.include,a.include),a.copy=j(b.copy,a.copy)),a.ignore=j(a.ignore,e.ignore),a.include=j(a.include,e.include),a.copy=j(a.copy,e.copy),a.mappedProperties={},a}function j(a,b){var c=[];return a instanceof Array||(h(a)==="undefined"?a=[]:a=[a]),b instanceof Array||(h(b)==="undefined"?b=[]:b=[b]),a.concat(b)}function k(b){var d=a.dependentObservable;a.dependentObservable=function(a,b,d){d=d||{},a&&typeof a=="object"&&(d=a),d.deferEvaluation=!0;var e=new c(a,b,d);return e.__ko_proto__=c,e};var e=b();return a.dependentObservable=d,e}function l(c,d,e,f,i,j,n){var s=a.utils.unwrapObservable(d)instanceof Array;n=n||"";if(a.mapping.isMapped(c)){var u=a.utils.unwrapObservable(c)[b];e=g(u,e)}var v=function(){return e[i]&&e[i].create instanceof Function};f=f||new t;if(f.get(d))return c;i=i||"";if(!s)if(!r(d))switch(h(d)){case"function":c=d;break;default:a.isWriteableObservable(c)?c(a.utils.unwrapObservable(d)):v()?c=k(function(){return e[i].create({data:d,parent:j})}):c=a.observable(a.utils.unwrapObservable(d))}else{if(!c){if(v()){var w=k(function(){return e[i].create({data:d,parent:j})});return w}c={}}f.save(d,c),q(d,function(b){var g=n.length?n+"."+b:b;if(a.utils.arrayIndexOf(e.ignore,g)!=-1)return;if(a.utils.arrayIndexOf(e.copy,g)!=-1){c[b]=d[b];return}var h,i=f.get(d[b]);i?c[b]=i:c[b]=l(c[b],d[b],e,f,b,c,g),e.mappedProperties[g]=!0})}else{var x=[],y=!1,z=function(a){return a};e[i]&&e[i].key&&(z=e[i].key,y=!0);var A=function(a){return a};v()&&(A=function(a){return e[i].create({data:a,parent:j})}),a.isObservable(c)||(c=a.observableArray([]),c.mappedRemove=function(a){var b=typeof a=="function"?a:function(b){return b===z(a)};return c.remove(function(a){return b(z(a))})},c.mappedRemoveAll=function(b){var d=p(b,z);return c.remove(function(b){return a.utils.arrayIndexOf(d,z(b))!=-1})},c.mappedDestroy=function(a){var b=typeof a=="function"?a:function(b){return b===z(a)};return c.destroy(function(a){return b(z(a))})},c.mappedDestroyAll=function(b){var d=p(b,z);return c.destroy(function(b){return a.utils.arrayIndexOf(d,z(b))!=-1})},c.mappedIndexOf=function(b){var d=p(c(),z),e=z(b);return a.utils.arrayIndexOf(d,e)},c.mappedCreate=function(a){if(c.mappedIndexOf(a)!==-1)throw new Error("There already is an object with the key that you specified.");var b=A(a);return c.push(b),b});var B=p(a.utils.unwrapObservable(c),z).sort(),C=p(d,z);y&&C.sort();var D=a.utils.compareArrays(B,C),E={},F=[];for(var G=0,H=D.length;G<H;G++){var I=D[G],J,K=n+"["+G+"]";switch(I.status){case"added":var L=o(a.utils.unwrapObservable(d),I.value,z);J=a.utils.unwrapObservable(l(undefined,L,e,f,i,c,K));var M=m(a.utils.unwrapObservable(d),L,E);F[M]=J,E[M]=!0;break;case"retained":var L=o(a.utils.unwrapObservable(d),I.value,z);J=o(c,I.value,z),l(J,L,e,f,i,c,K);var M=m(a.utils.unwrapObservable(d),L,E);F[M]=J,E[M]=!0;break;case"deleted":J=o(c,I.value,z)}x.push({event:I.status,item:J})}c(F),e[i]&&e[i].arrayChanged&&a.utils.arrayForEach(x,function(a){e[i].arrayChanged(a.event,a.item)})}return c}function m(a,b,c){for(var d=0,e=a.length;d<e;d++){if(c[d]===!0)continue;if(a[d]==b)return d}return null}function n(b,c){var d;return c&&(d=c(b)),h(d)==="undefined"&&(d=b),a.utils.unwrapObservable(d)}function o(b,c,d){var e=a.utils.arrayFilter(a.utils.unwrapObservable(b),function(a){return n(a,d)===c});if(e.length==0)throw new Error("When calling ko.update*, the key '"+c+"' was not found!");if(e.length>1&&r(e[0]))throw new Error("When calling ko.update*, the key '"+c+"' was not unique!");return e[0]}function p(b,c){return a.utils.arrayMap(a.utils.unwrapObservable(b),function(a){return c?n(a,c):a})}function q(a,b){if(a instanceof Array)for(var c=0;c<a.length;c++)b(c);else for(var d in a)b(d)}function r(a){var b=h(a);return b=="object"&&a!==null&&b!=="undefined"}function s(a,b,c){var d=a||"";return b instanceof Array?a&&(d+="["+c+"]"):(a&&(d+="."),d+=c),d}function t(){var b=[],c=[];this.save=function(d,e){var f=a.utils.arrayIndexOf(b,d);f<0?(b.push(d),c.push(e)):c[f]=e},this.get=function(d){var e=a.utils.arrayIndexOf(b,d);return e<0?undefined:c[e]}}a.mapping={};var b="__ko_mapping__",c=a.dependentObservable,d={include:["_destroy"],ignore:[],copy:[]},e=d;a.mapping.fromJS=function(a,c,d){if(arguments.length==0)throw new Error("When calling ko.fromJS, pass the object you want to convert.");c=i(c);var e=l(d,a,c);return e[b]=g(e[b],c),e},a.mapping.fromJSON=function(b,c){var d=a.utils.parseJson(b);return a.mapping.fromJS(d,c)},a.mapping.isMapped=function(c){var d=a.utils.unwrapObservable(c);return d&&d[b]},a.mapping.updateFromJS=function(a){if(arguments.length<2||arguments.length>3)throw new Error("When calling ko.updateFromJS, pass: the object to update and the object you want to update from.");if(!a)throw new Error("The object is undefined.");var c,d;return arguments.length==2?(c=arguments[1],d=a[b]):(d=arguments[1],c=arguments[2],a[b]&&(d=g(a[b],d)),a[b]=d),d=i(d),l(a,c,d)},a.mapping.updateFromJSON=function(b){if(arguments.length<2||arguments.length>3)throw new Error("When calling ko.updateFromJSON, pass: the object to update and the JSON string you want to update from.");return arguments.length==2?a.mapping.updateFromJS(b,a.utils.parseJson(arguments[1])):a.mapping.updateFromJS(b,arguments[1],a.utils.parseJson(arguments[2]))},a.mapping.toJS=function(c,d){e||a.mapping.resetDefaultOptions();if(arguments.length==0)throw new Error("When calling ko.mapping.toJS, pass the object you want to convert.");if(e.ignore instanceof Array){if(e.include instanceof Array){if(e.copy instanceof Array)return d=i(d,c[b]),a.mapping.visitModel(c,function(b){return a.utils.unwrapObservable(b)},d);throw new Error("ko.mapping.defaultOptions().copy should be an array.")}throw new Error("ko.mapping.defaultOptions().include should be an array.")}throw new Error("ko.mapping.defaultOptions().ignore should be an array.")},a.mapping.toJSON=function(b,c){var d=a.mapping.toJS(b,c);return a.utils.stringifyJson(d)},a.mapping.defaultOptions=function(){if(arguments.length>0)e=arguments[0];else return e},a.mapping.resetDefaultOptions=function(){e={include:d.include.slice(0),ignore:d.ignore.slice(0),copy:d.copy.slice(0)}},a.mapping.visitModel=function(c,d,e){e=e||{},e.visitedObjects=e.visitedObjects||new t,e.parentName||(e=i(e));var f,g=a.utils.unwrapObservable(c);if(!r(g))return d(c,e.parentName);d(c,e.parentName),f=g instanceof Array?[]:{},e.visitedObjects.save(c,f);var j=e.parentName;return q(g,function(c){if(e.ignore&&a.utils.arrayIndexOf(e.ignore,c)!=-1)return;var i=g[c];e.parentName=s(j,g,c);if(a.utils.arrayIndexOf(e.copy,c)===-1&&a.utils.arrayIndexOf(e.include,c)===-1&&g[b]&&g[b].mappedProperties&&!g[b].mappedProperties[c]&&!(g instanceof Array))return;var k;switch(h(a.utils.unwrapObservable(i))){case"object":case"undefined":var l=e.visitedObjects.get(i);f[c]=h(l)!=="undefined"?l:a.mapping.visitModel(i,d,e);break;default:f[c]=d(i,e.parentName)}}),f},a.exportSymbol("ko.mapping",a.mapping),a.exportSymbol("ko.mapping.fromJS",a.mapping.fromJS),a.exportSymbol("ko.mapping.fromJSON",a.mapping.fromJSON),a.exportSymbol("ko.mapping.isMapped",a.mapping.isMapped),a.exportSymbol("ko.mapping.defaultOptions",a.mapping.defaultOptions),a.exportSymbol("ko.mapping.toJS",a.mapping.toJS),a.exportSymbol("ko.mapping.toJSON",a.mapping.toJSON),a.exportSymbol("ko.mapping.updateFromJS",a.mapping.updateFromJS),a.exportSymbol("ko.mapping.updateFromJSON",a.mapping.updateFromJSON),a.exportSymbol("ko.mapping.visitModel",a.mapping.visitModel)}()})